import com.azure.identity.ClientCertificateCredential;
import com.azure.identity.ClientCertificateCredentialBuilder;
import com.microsoft.graph.authentication.TokenCredentialAuthProvider;
import com.microsoft.graph.models.User;
import com.microsoft.graph.requests.GraphServiceClient;

import java.util.Base64;
import java.util.Collections;
import java.util.List;

public class Outlook365ListUsersExample {

    private static final String CLIENT_ID = "<your-client-id>";
    private static final String TENANT_ID = "<your-tenant-id>";

    private static final String PRIVATE_KEY_PEM = """
            -----BEGIN PRIVATE KEY-----
            YOUR_BASE64_ENCODED_PRIVATE_KEY
            -----END PRIVATE KEY-----
            """;

    private static final List<String> SCOPES = Collections.singletonList("https://graph.microsoft.com/.default");

    public static void main(String[] args) {
        ClientCertificateCredential credential = new ClientCertificateCredentialBuilder()
                .clientId(CLIENT_ID)
                .tenantId(TENANT_ID)
                .pemCertificate(PRIVATE_KEY_PEM)
                .build();

        TokenCredentialAuthProvider authProvider = new TokenCredentialAuthProvider(SCOPES, credential);

        GraphServiceClient<?> graphClient = GraphServiceClient
                .builder()
                .authenticationProvider(authProvider)
                .buildClient();

        List<User> users = graphClient
                .users()
                .buildRequest()
                .top(20)  // Fetch first 20 users
                .get()
                .getCurrentPage();

        users.forEach(user -> {
            System.out.printf("User: %s | Email: %s | ID: %s%n",
                    user.displayName,
                    user.mail,
                    user.id);
        });
    }
}


<dependencies>
    <dependency>
        <groupId>com.microsoft.azure</groupId>
        <artifactId>msal4j</artifactId>
        <version>1.14.0</version>
    </dependency>
    <dependency>
        <groupId>com.azure</groupId>
        <artifactId>azure-identity</artifactId>
        <version>1.11.3</version>
    </dependency>
    <dependency>
        <groupId>com.microsoft.graph</groupId>
        <artifactId>microsoft-graph</artifactId>
        <version>5.74.0</version>
    </dependency>
    <dependency>
        <groupId>com.azure</groupId>
        <artifactId>azure-core</artifactId>
        <version>1.47.0</version>
    </dependency>
</dependencies>
